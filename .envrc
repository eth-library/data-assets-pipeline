# Use the Nix flake in this directory
use flake

# Watch for changes in these files to trigger environment reload
watch_file pyproject.toml
watch_file flake.nix
watch_file uv.lock

# Auto-activate venv if it exists, or prompt for setup
echo ""
echo "ETH Library Zurich - Data Archive Pipeline (DAP) - Orchestrator"
echo "───────────────────────────────────────────────────────────────"
echo "✓ nix flake activated (python, uv, kubectl, helm, just)"

export DAGSTER_HOME="$PWD"

if [ -d .venv ]; then
    source .venv/bin/activate
    echo "✓ python venv activated"
    echo "✓ DAGSTER_HOME set to $DAGSTER_HOME"
    echo ""
    echo "  just            show available commands"
    echo "  just info       show tool versions"
    echo "  just dev        start Dagster dev server"
else
    echo "⚠ python venv not found"
    echo ""
    echo "  just setup      create venv and install dependencies using uv"
fi
echo ""
