# Base Helm values for da-pipeline Dagster deployment
# These values are shared across all environments
---

####################################################################################################
# User Code Deployments
####################################################################################################
dagster-user-deployments:
  enabled: true
  enableSubchart: true

  deployments:
    - name: "da-pipeline"
      image:
        repository: da-pipeline
        tag: latest
        pullPolicy: Always
      dagsterApiGrpcArgs:
        - "--python-file"
        - "/da_pipeline/definitions.py"
      port: 3030
      includeConfigInLaunchedRuns:
        enabled: true
      resources:
        requests:
          memory: "256Mi"
          cpu: "100m"
        limits:
          memory: "512Mi"
          cpu: "500m"
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        allowPrivilegeEscalation: false

####################################################################################################
# Run Launcher
####################################################################################################
runLauncher:
  type: K8sRunLauncher
  config:
    k8sRunLauncher:
      loadInclusterConfig: true

####################################################################################################
# Scheduler
####################################################################################################
scheduler:
  type: DagsterDaemonScheduler

####################################################################################################
# PostgreSQL
####################################################################################################
# Password is stored in a Kubernetes Secret
# This prevents secrets from being stored in Helm values or version control.
generatePostgresqlPasswordSecret: false

global:
  postgresqlSecretName: dagster-postgresql

postgresql:
  enabled: true
  postgresqlUsername: dagster
  postgresqlDatabase: dagster
  # Use external secret
  existingSecret: dagster-postgresql

####################################################################################################
# Disabled components
####################################################################################################
rabbitmq:
  enabled: false

redis:
  enabled: false

flower:
  enabled: false

ingress:
  enabled: false

migrate:
  enabled: false

telemetry:
  enabled: false

retention:
  enabled: false

####################################################################################################
# Dagster Instance Configuration
####################################################################################################
dagsterYaml:
  telemetry:
    enabled: false
